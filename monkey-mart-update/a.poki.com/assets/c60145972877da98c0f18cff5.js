"use strict";(self.__LOADABLE_LOADED_CHUNKS__=self.__LOADABLE_LOADED_CHUNKS__||[]).push([[6014],{6014:(e,t,n)=>{n.r(t),n.d(t,{fetchSaveGameEpic:()=>$,fixIOSFullscreen:()=>ne,forwardPostMessageEpic:()=>X,fullscreenEpic:()=>re,gameBootEpic:()=>Y,gameLoadingFinishedEpic:()=>le,generateScreenshotEpic:()=>ce,mutateSaveGameEpic:()=>Q,pubHostInitializedEpic:()=>Z,receivePostMessageEpic:()=>K,receiveScreenshotEpic:()=>ue,sendBugReportEpic:()=>se,setRecentGameEpic:()=>oe,switchWorldToEpic:()=>q,trackRecentGameEpic:()=>ae,updatePokiURLParams:()=>z,worldSwitchedToEpic:()=>j});var i=n(1545),o=n(2817),a=n(2401),r=n(3071),l=n(6625),c=n(9635),s=n(4975),u=n(2006),d=n(9127),p=n(533),v=n(4978),m=n(6108),g=n(7782),w=n(2965),f=n(3505),h=n(4406),y=n(7606),E=n(5069),_=n(4678),b=n(8813),k=n(905),S=n(3748),D=n(4481),F=n(6151),B=n(7344),I=n(8855),R=n(8656),L=n(9563),G=n(65),M=n(8092),O=n(4927),A=n(8342),H=n(6084),U=n(5585),J=n(4691),T=n(9317),N=n(6619),P=n(7261),x=n(5322),W=n(8389);const V=["localhost","games.poki.com","game-cdn.poki.com"],C={CrossyMultiverseMessage_worldSwitchedTo:k.VN,pubHostInitialized:k.B5,[L.cO]:k.OB,[L.xE]:k.aw,[L.A$]:k.PP,[L.Yn]:k.iq,[L.Fj]:k.BF,fetchSaveGame:k.WV,mutateSaveGame:k.nE,SaveGameMigrator:!0};function K(e){return e.pipe((0,E.l)(k.y6.type),(0,s.h)((e=>{let{event:t}=e;if(!t.data.type||!C[t.data.type])return!1;const n=(0,D._Y)(t.origin),i=V.includes(n)||n.endsWith(".poki-gdn.com")||window.location.origin===t.origin,o=document.querySelector('iframe[name="gameFrame"]'),a=o&&o.src.startsWith(t.origin);return i||a})),(0,u.b)((e=>{let{event:{data:{content:t,type:n}}}=e;if(["pokiMessageEvent","pokiMessageDebug","SaveGameMigrator"].includes(n)&&((0,S.A)({category:"sdk",action:"message",data:{content:t,type:n}}),window.parent!==window)){const e="production"===process.env.SERVICE_ENV;window.parent.postMessage({content:t,type:n},e?"devs.poki.io":"*")}})),(0,s.h)((e=>{let{event:{data:{type:t}}}=e;return"function"==typeof C[t]})),(0,d.U)((e=>{let{event:{data:{content:t,type:n},source:i}}=e;return C[n]({...t,source:i})})))}function q(e,t){return e.pipe((0,E.l)(k.Ot.type),(0,s.h)((()=>window.frames.gameFrame)),(0,s.h)((e=>{let{world:n}=e;return(0,I.Bs)(t.value)!==n})),(0,u.b)((e=>{var t,n,i;let{world:o}=e;null===(t=window)||void 0===t||null===(n=t.frames)||void 0===n||null===(i=n.gameFrame)||void 0===i||i.postMessage({type:"CrossyMultiverseMessage_switchWorldTo",content:{worldName:o}},"*")})),(0,d.U)((e=>(0,k.Bn)({world:e,gameId:(0,R.J1)(t.value).id}))))}function j(e,t){return e.pipe((0,E.l)(k.VN.type),(0,d.U)((e=>{let{worldName:t}=e;return t})),(0,s.h)((e=>(0,I.Bs)(t.value)!==e)),(0,d.U)((e=>(0,k.Bn)({world:e,gameId:(0,R.J1)(t.value).id}))))}function z(e){return e.pipe((0,E.l)(k.PP.type),(0,u.b)((e=>{const{params:t}=e;if(!t)return;const n=Object.keys(t),i=new URLSearchParams(window.location.search),o=[];i.forEach(((e,t)=>{t.startsWith("gd")&&o.push(t)})),o.forEach((e=>{i.delete(e)})),n.forEach((e=>{i.set("gd".concat(e),t[e])})),window.history.replaceState({},document.title,"".concat(window.location.pathname,"?").concat(i.toString()))})),(0,p.l)())}function Y(e){return e.pipe((0,E.l)(k.Gq.type),(0,u.b)((()=>{(0,S.A)({category:"game",action:"iframeLoaded",options:{once_per_pageview:!0}}),(0,G.u)()})),(0,p.l)())}function Z(e,t){return e.pipe((0,E.l)(k.B5.type),(0,v.w)((e=>{const n=(0,R.J1)(t.value);return n?((0,S.A)({category:"pubHost",action:"initialized",data:e}),(0,o.of)((0,k.P8)({gameId:n.id,data:e}))):i.E})))}function Q(e,t){return e.pipe((0,E.l)(k.nE.type),(0,u.b)((async e=>{let{action:n,key:i,value:o}=e;const a=(0,R.J1)(t.value);if(a)try{const e=(0,_.MT)("savegame:".concat(a.id),"ls");"clear"===n?await(0,_.ZH)(e):"delete"===n?await(0,_.IV)(i,e):"set"===n&&await(0,_.t8)(i,o,e)}catch(e){console.error(e)}})),(0,p.l)())}function $(e,t){return e.pipe((0,E.l)(k.WV.type),(0,u.b)((async()=>{const e=(0,R.J1)(t.value);if(e)try{var n,i,o;const t=(0,_.MT)("savegame:".concat(e.id),"ls"),a=(await(0,_.qh)(t)).reduce(((e,t)=>{let[n,i]=t;return e[n]=i,e}),{});null===(n=window.frames)||void 0===n||null===(i=n.gameFrame)||void 0===i||null===(o=i.postMessage)||void 0===o||o.call(i,{type:"fetchedSaveGame",data:a},"*")}catch(e){console.error(e)}})),(0,p.l)())}function X(){return window.removeEventListener("message",messageListener),(0,a.R)(window,"message").pipe((0,m.O)(...messageBuffer),(0,g.g)(0),(0,d.U)((e=>(0,k.y6)({event:e}))))}const ee=()=>document.getElementById("game-container"),te=()=>{const e=document.getElementById("game-element");e&&(window.scrollTo(0,0),e.style.width="".concat(window.innerWidth,"px"),e.style.height="".concat(window.innerHeight,"px"))};function ne(e,t){if(!(0,F.eD)(t.value)||"undefined"==typeof window)return i.E;const n=(0,a.R)(window,"resize").pipe((0,g.g)(500),(0,v.w)((()=>(te(),i.E))),(0,w.b)(3e3)),o=(0,a.R)(window,"orientationchange").pipe((0,v.w)((()=>(te(),i.E))),(0,w.b)(3e3));return e.pipe((0,E.l)(k.Gq.type),(0,g.g)(3e3),(0,u.b)((()=>{(0,G.u)(),te()}))).pipe((0,v.w)((()=>(0,r.T)(n,o))))}const ie=async(e,t)=>{const n=(0,F.At)(t),i=(0,F.QJ)(t);if(!n&&!i){try{var o;await(null==e||null===(o=e.requestFullscreen)||void 0===o?void 0:o.call(e,{navigationUI:"hide"}).catch((()=>{})))}catch(e){}e.focus()}const a=(0,R.J1)(t);if((0,F.eD)(t)&&a&&a.mobile_file&&a.mobile_file.orientation){const{orientation:e}=a.mobile_file;if(["portrait","landscape"].includes(e))try{var r,l,c,s;null===(r=window)||void 0===r||null===(l=r.screen)||void 0===l||null===(c=l.orientation)||void 0===c||null===(s=c.lock)||void 0===s||s.call(c,e).catch((()=>{}))}catch(e){}}};function oe(e,t){if("undefined"==typeof window)return i.E;const n=(0,B.lH)(t.value);return e.pipe((0,E.l)(b.JV.type,O.o8.type),(0,s.h)((()=>{const e="game"===(0,R.Wj)(t.value),n=(0,R.Q4)(t.value);return e&&200===n})),(0,d.U)((()=>{const e=(0,R.J1)(t.value),{id:o}=e||{};if(!o)return i.E;const a=(0,F.jw)(t.value)||[],r=a.findIndex((e=>e.id===o)),l=r>-1?a.filter((e=>e.id!==o)):a,c={id:o,pt:r>-1?a[r].pt:0,lp:Date.now()};l.unshift(c);const s=l.slice(0,12);return(0,b.FR)({recentGames:s,siteID:n.id})})))}function ae(e,t){if("undefined"==typeof window)return i.E;const n=(0,B.lH)(t.value),o=e.pipe((0,E.l)(O.o8.type));return e.pipe((0,E.l)(b.FR.type),(0,v.w)((()=>(0,l.H)(6e4).pipe((0,d.U)((()=>{const{id:e}=(0,R.J1)(t.value),o=(0,F.jw)(t.value),a=o.find((t=>t.id===e));if(a){const t=parseInt(a.pt||0,10)+1,i=o.map((n=>n.id===e?{...n,pt:t}:n));return(0,b.FR)({recentGames:i,siteID:n.id})}return i.E})),(0,f.R)(o)))))}function re(e,t){const n=(0,a.R)(window,"fullscreenchange").pipe((0,v.w)((()=>{var e,n,a;return(0,N.k)(),(0,I.Eo)(t.value)!==!(null===(e=document)||void 0===e||!e.fullscreenElement)&&(!(0,F.eD)(t.value)||null!==(n=document)&&void 0!==n&&n.fullscreenElement)?(0,o.of)((0,k.K1)({toggle:!(null===(a=document)||void 0===a||!a.fullscreenElement)})):i.E}))),l=e.pipe((0,E.l)(k.Zx.type),(0,s.h)((e=>{let{toggle:t}=e;return t})),(0,v.w)((()=>(0,c.D)(ie(document.body,t.value)).pipe((0,d.U)((()=>(0,k.K1)({toggle:!0}))))))),m=()=>{var e,t,n;null===(e=window)||void 0===e||null===(t=e.PokiSDK)||void 0===t||null===(n=t.stopVideoAd)||void 0===n||n.call(t),(0,M.aH)();try{var i,a;null===(i=document)||void 0===i||null===(a=i.exitFullscreen)||void 0===a||a.call(i).catch((()=>{}))}catch(e){}return window.removeEventListener("resize",te),window.removeEventListener("orientationchange",te),(0,o.of)((0,k.K1)({toggle:!1}))},g=e.pipe((0,E.l)(k.Zx.type),(0,s.h)((e=>{let{toggle:t}=e;return!t})),(0,v.w)((()=>m()))),w=e.pipe((0,E.l)("@@router/LOCATION_CHANGE"),(0,s.h)((()=>!window.location.toString().includes("#fullscreen")&&!window.location.toString().includes("#goog_rewarded"))),(0,v.w)((()=>m()))),h=e.pipe((0,E.l)(k.Gq.type),(0,s.h)((e=>{let{el:n}=e;return(0,F.eD)(t.value)&&n})),(0,v.w)((e=>{let{el:n}=e;return(0,r.T)((0,a.R)(ee(),"click"),(0,a.R)(n,"click")).pipe((0,s.h)((()=>(0,F.eD)(t.value))),(0,u.b)((()=>{ie(document.body,t.value)})),(0,f.R)(g),(0,p.l)())}))),y=e.pipe((0,E.l)(k.K1.type),(0,v.w)((e=>{let{toggle:t}=e;const{body:n}=document,o=document.getElementById("app-root");return o.style.overflow=t?"hidden":"auto",o.style.height=t?"100vh":"auto",t?n.classList.add("isFullscreen"):n.classList.remove("isFullscreen"),i.E})));return(0,r.T)(l,g,w,n,h,y)}function le(e){return e.pipe((0,E.l)(k.OB.type),(0,s.h)((e=>{let{event:t}=e;return t===L.tn})),(0,d.U)((()=>(0,k.sn)())))}function ce(e,t){return e.pipe((0,E.l)(k.mY.type),(0,h.p)(3e3),(0,s.h)((()=>{var e,t;return null===(e=window)||void 0===e||null===(t=e.frames)||void 0===t?void 0:t.gameFrame})),(0,u.b)((e=>{var n;let{callback:i}=e;const o="screenshot"===i,a=(0,R.J1)(t.value);window.frames.gameFrame.postMessage({type:"pokiGenerateScreenshot",hasFrame:o,title:a.title,thumbnail:null===(n=a.image)||void 0===n?void 0:n.path,callback:i},"*")})))}function se(e,t){return e.pipe((0,E.l)(P._s.type),(0,v.w)((()=>{var e;const n=(0,J.fx)(t.value),i=(0,I.aY)(t.value),o=i?"".concat(n,"\n\n").concat(i):n,a=(0,A.Z)(t.value,"tracking"),r=(0,H.d)(t.value),l=(0,I.R6)(t.value),c=(0,B.lH)(t.value),s=(0,R.J1)(t.value),u=(0,T.N9)(t.value),d=(0,I.FK)(t.value),v=(0,I.tL)(t.value),m=(0,U.W)(t.value),g=l.gameID===s.pokifordevs_game_id?l.gameVersion:void 0,w=(null==m||null===(e=m.page)||void 0===e?void 0:e.start)>0?Date.now()-m.page.start:0,f=document.getElementById("game-element");let h;f&&(h="".concat(f.clientWidth,"x").concat(f.clientHeight));return a("/playground-feedback",{method:"POST",body:JSON.stringify({p4d_game_id:s.pokifordevs_game_id,p4d_version_id:g,type:"bugreport",site_id:c.id,message:o,experiment:r,adblock:u,was_fullscreen:d,game_resolution:h,loading_finished:v,time_on_page:w})}).pipe((0,p.l)())})))}function ue(e,t){return e.pipe((0,E.l)(k.BF.type),(0,y.j)("data"),(0,v.w)((e=>{let{screenshot:n,callback:a}=e;if("bugReport"===a)try{return(0,r.T)((0,o.of)((0,k.yN)({screenshot:n})),(0,o.of)((0,P._s)()))}catch(e){return i.E}if("ratings"===a)try{const e=(0,x.Cy)(t.value);return(0,o.of)((0,W.CE)({voteDirection:e.voteDirection,message:e.message,screenshot:n}))}catch(e){return i.E}})))}}}]);